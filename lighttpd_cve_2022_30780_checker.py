import requests, sys
import urllib3
from requests.packages.urllib3.exceptions import InsecureRequestWarning

urllib3.disable_warnings(InsecureRequestWarning)
vulnerable_versions = ['1.4.56', '1.4.57', '1.4.58']

def get_lighttpd_version(url):
    try:
        response = requests.get(url, timeout=3, verify=False)
        server_header = response.headers.get('Server', '')
        
        if 'lighttpd' in server_header.lower():
            version = server_header.split('/')[1]
            vulnerable = True if version in vulnerable_versions else False
            print(f"[{'!' if vulnerable else '+'}] Target: {url} Lighttpd version: {version} Vulnerable: {vulnerable}")
        else:
            print("[-] The server does not appear to be running Lighttpd.")
    
    except requests.RequestException as e:
        print(f"[-] An error occurred: {e}")

if __name__ == "__main__":
    try:
        url = sys.argv[1]
        get_lighttpd_version(url)
    except IndexError:
        print("[*] Usage: python3 lighttpd_cve_2022_30780_checker.py http://127.0.0.1")
